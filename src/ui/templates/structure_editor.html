<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📝 LLMReader 文档结构编辑器</title>

    <!-- CSS 样式 -->
    <link rel="stylesheet" href="/static/css/variables.css">
    <link rel="stylesheet" href="/static/css/base.css">
    <link rel="stylesheet" href="/static/css/components.css">
    <link rel="stylesheet" href="/static/css/structure_editor.css">

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
</head>
<body>
    <!-- 结构编辑器页面容器 -->
    <div class="app-container">
        <!-- 顶部导航栏 -->
        <header class="header structure-header">
            <div class="header-content structure-header-content">
                <div class="structure-header-left">
                    <h1 class="header-title structure-header-title">章节管理</h1>
                    <p class="header-subtitle structure-header-subtitle">编辑文档章节结构，保存后可重建索引和摘要</p>
                </div>
                <div class="structure-header-actions">
                    <a href="/data" class="btn structure-back-btn">返回数据管理</a>
                </div>
            </div>
        </header>

        <!-- 主要内容区域 -->
        <main class="main-content structure-editor-main">
            <!-- 文档选择区域 -->
            <div class="document-selector">
                <div class="selector-content">
                    <label for="doc-select">选择文档：</label>
                    <select id="doc-select" class="doc-select">
                        <option value="">-- 请选择文档 --</option>
                    </select>
                    <div class="doc-info" id="doc-info" style="display: none;">
                        <span id="doc-total-pages">总页数: -</span>
                        <span id="doc-total-chapters">总章节: -</span>
                    </div>
                </div>
            </div>

            <!-- 编辑器区域 -->
            <div class="editor-container" id="editor-container" style="display: none;">
                <!-- 左侧：章节编辑器 -->
                <div class="editor-panel">
                    <div class="panel-header">
                        <h3>章节列表</h3>
                        <div style="display: flex; gap: 5px;">
                            <button class="btn btn-primary btn-sm" id="add-chapter-btn">
                                ➕ 添加章节
                            </button>
                            <button class="btn btn-danger btn-sm" id="batch-delete-btn" style="display: none;">
                                🗑️ 批量删除
                            </button>
                            <button class="btn btn-secondary btn-sm" id="cancel-batch-btn" style="display: none;">
                                ❌ 取消
                            </button>
                        </div>
                    </div>

                    <div class="panel-content">
                        <!-- 批量操作提示 -->
                        <div id="batch-mode-hint" class="batch-mode-hint" style="display: none;">
                            <input type="checkbox" id="select-all-chapters"> 全选
                            <span id="selected-count" style="margin-left: 10px;">已选择 0 个章节</span>
                        </div>

                        <!-- 章节列表 -->
                        <div id="chapters-list" class="chapters-list">
                            <!-- 章节项将通过 JS 动态生成 -->
                        </div>
                    </div>

                    <div class="panel-footer">
                        <button class="btn btn-warning" id="rebuild-btn" style="width: 100%;">
                            🔄 重建索引和摘要
                        </button>
                    </div>
                </div>

                <div class="panel-resizer" id="panel-resizer" title="拖动调整宽度"></div>

                <!-- 右侧：PDF 预览 -->
                <div class="preview-panel">
                    <div class="panel-header">
                        <h3>PDF 预览</h3>
                        <div class="preview-controls">
                            <span id="page-info">页码: - / -</span>
                            <div class="page-jump">
                                <input type="number" id="page-jump-input" min="1" placeholder="跳页">
                                <button class="btn btn-sm btn-secondary" id="page-jump-btn">跳转</button>
                            </div>
                            <button class="btn btn-sm btn-secondary" id="zoom-out-btn">🔍-</button>
                            <span id="zoom-level">100%</span>
                            <button class="btn btn-sm btn-secondary" id="zoom-in-btn">🔍+</button>
                        </div>
                    </div>

                    <div class="panel-content pdf-preview-container" style="overflow-y: auto;">
                        <div id="pdf-viewer" class="pdf-viewer">
                            <div id="pdf-pages-container"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 加载状态 -->
            <div id="loading-overlay" class="loading-overlay" style="display: none;">
                <div class="loading-content">
                    <div class="spinner"></div>
                    <p id="loading-message">加载中...</p>
                </div>
            </div>
        </main>
    </div>

    <!-- 添加/编辑章节对话框 -->
    <div id="chapter-dialog" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="dialog-title">添加章节</h3>
                <button class="close-btn" id="close-dialog-btn">×</button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label for="chapter-title-input">章节标题：</label>
                    <input type="text" id="chapter-title-input" class="form-control" placeholder="输入章节标题">
                </div>
                <div class="form-group">
                    <label for="chapter-pages-input">页码范围（用逗号分隔，支持范围如 1-5）：</label>
                    <input type="text" id="chapter-pages-input" class="form-control" placeholder="例如: 1-5, 7, 9-12">
                    <small class="form-hint">示例: "1-5" 表示第1到5页，"1-3, 5, 7-9" 表示多个不连续的页面</small>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-dialog-btn">取消</button>
                <button class="btn btn-primary" id="confirm-dialog-btn">确定</button>
            </div>
        </div>
    </div>


    <!-- JavaScript -->
    <script src="/static/js/structure_editor.js"></script>
</body>
</html>
