<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📁 LLMReader 数据管理</title>

    <!-- CSS 样式 -->
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <!-- 数据管理页面容器 -->
    <div class="app-container">
        <!-- 顶部导航栏 -->
        <header class="header">
            <div class="header-content">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 class="header-title">📁 LLMReader 数据管理</h1>
                        <p class="header-subtitle">管理文档数据、清理缓存文件、监控存储使用情况</p>
                    </div>
                    <div>
                        <a href="/" class="btn btn-secondary" style="color: white; text-decoration: none; margin-right: 10px;">
                            🏠 首页
                        </a>
                        <a href="/config" class="btn btn-secondary" style="color: white; text-decoration: none; margin-right: 10px;">
                            ⚙️ 配置管理
                        </a>
                        <a href="/chapters" class="btn btn-secondary" style="color: white; text-decoration: none; margin-right: 10px;">
                            📖 章节管理
                        </a>
                        <a href="/chat" class="btn btn-secondary" style="color: white; text-decoration: none;">
                            💬 聊天模式
                        </a>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主要内容区域 -->
        <main class="main-content" style="max-width: 1000px;">
            <div class="content-area">
                <!-- 存储概览 -->
                <section class="data-overview">
                    <h3>📊 存储概览</h3>
                    <div class="storage-stats">
                        <div class="stat-card">
                            <div class="stat-icon">📄</div>
                            <div class="stat-info">
                                <div class="stat-value" id="total-documents">-</div>
                                <div class="stat-label">处理文档数</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">💾</div>
                            <div class="stat-info">
                                <div class="stat-value" id="total-size">-</div>
                                <div class="stat-label">总存储大小</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">💬</div>
                            <div class="stat-info">
                                <div class="stat-value" id="chat-sessions">-</div>
                                <div class="stat-label">聊天会话数</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon">🔄</div>
                            <div class="stat-info">
                                <div class="stat-value" id="last-cleanup">-</div>
                                <div class="stat-label">上次清理</div>
                            </div>
                        </div>
                    </div>
                </section>

                <hr class="section-divider">

                <!-- 文档管理 -->
                <section class="document-management">
                    <h3>📚 文档管理</h3>

                    <div class="management-tabs">
                        <button class="tab-btn active" data-tab="documents">📄 已处理文档</button>
                        <button class="tab-btn" data-tab="cache">🗃️ 缓存文件</button>
                        <button class="tab-btn" data-tab="chat">💬 聊天数据</button>
                    </div>

                    <!-- 已处理文档标签页 -->
                    <div id="documents-tab" class="management-tab-content active">
                        <div class="tab-header">
                            <h4>📄 已处理的文档</h4>
                            <div class="tab-actions">
                                <button id="refresh-documents-btn" class="btn btn-secondary btn-sm">🔄 刷新</button>
                                <button id="cleanup-old-documents-btn" class="btn btn-warning btn-sm">🧹 清理旧文档</button>
                            </div>
                        </div>

                        <div class="document-list" id="document-list">
                            <div class="loading-message">正在加载文档列表...</div>
                        </div>
                    </div>

                    <!-- 缓存文件标签页 -->
                    <div id="cache-tab" class="management-tab-content">
                        <div class="tab-header">
                            <h4>🗃️ 缓存文件管理</h4>
                            <div class="tab-actions">
                                <button id="refresh-cache-btn" class="btn btn-secondary btn-sm">🔄 刷新</button>
                                <button id="clear-all-cache-btn" class="btn btn-danger btn-sm">🗑️ 清空所有缓存</button>
                            </div>
                        </div>

                        <div class="cache-categories">
                            <div class="cache-category">
                                <h5>🖼️ PDF图片缓存</h5>
                                <p class="category-description">PDF转换生成的图片文件</p>
                                <div class="cache-stats">
                                    <span id="pdf-cache-count">- 个文件</span>
                                    <span id="pdf-cache-size">- MB</span>
                                </div>
                                <button id="clear-pdf-cache-btn" class="btn btn-warning btn-sm">清理</button>
                            </div>

                            <div class="cache-category">
                                <h5>📊 向量数据库</h5>
                                <p class="category-description">文档向量化数据和索引</p>
                                <div class="cache-stats">
                                    <span id="vector-cache-count">- 个文件</span>
                                    <span id="vector-cache-size">- MB</span>
                                </div>
                                <button id="clear-vector-cache-btn" class="btn btn-warning btn-sm">清理</button>
                            </div>

                            <div class="cache-category">
                                <h5>📝 JSON数据缓存</h5>
                                <p class="category-description">文档解析结果和元数据</p>
                                <div class="cache-stats">
                                    <span id="json-cache-count">- 个文件</span>
                                    <span id="json-cache-size">- MB</span>
                                </div>
                                <button id="clear-json-cache-btn" class="btn btn-warning btn-sm">清理</button>
                            </div>
                        </div>
                    </div>

                    <!-- 聊天数据标签页 -->
                    <div id="chat-tab" class="management-tab-content">
                        <div class="tab-header">
                            <h4>💬 聊天数据管理</h4>
                            <div class="tab-actions">
                                <button id="refresh-chat-btn" class="btn btn-secondary btn-sm">🔄 刷新</button>
                                <button id="export-chat-history-btn" class="btn btn-info btn-sm">📤 导出历史</button>
                            </div>
                        </div>

                        <div class="chat-statistics">
                            <div class="chat-stat-item">
                                <span class="stat-icon">🗣️</span>
                                <span class="stat-text">本地聊天会话: <strong id="local-sessions-count">-</strong></span>
                            </div>
                            <div class="chat-stat-item">
                                <span class="stat-icon">💾</span>
                                <span class="stat-text">服务器聊天历史: <strong id="server-history-count">-</strong></span>
                            </div>
                            <div class="chat-stat-item">
                                <span class="stat-icon">📅</span>
                                <span class="stat-text">最近活动: <strong id="last-chat-activity">-</strong></span>
                            </div>
                        </div>

                        <div class="chat-actions">
                            <button id="clear-local-sessions-btn" class="btn btn-warning">🧹 清理本地会话</button>
                            <button id="clear-server-history-btn" class="btn btn-danger">🗑️ 清空服务器历史</button>
                        </div>

                        <div class="chat-note">
                            <p><strong>💡 说明:</strong></p>
                            <ul>
                                <li>本地会话存储在浏览器的localStorage中</li>
                                <li>服务器历史包含完整的对话记录</li>
                                <li>清理操作不可撤销，请谨慎操作</li>
                            </ul>
                        </div>
                    </div>
                </section>

                <hr class="section-divider">

                <!-- 批量操作 -->
                <section class="bulk-operations">
                    <h3>⚡ 批量操作</h3>

                    <div class="bulk-actions">
                        <div class="bulk-action-card">
                            <div class="action-icon">🧹</div>
                            <div class="action-content">
                                <h4>智能清理</h4>
                                <p>自动清理超过30天的缓存文件和过期数据</p>
                                <button id="smart-cleanup-btn" class="btn btn-warning">开始智能清理</button>
                            </div>
                        </div>

                        <div class="bulk-action-card">
                            <div class="action-icon">📦</div>
                            <div class="action-content">
                                <h4>数据备份</h4>
                                <p>导出重要数据和配置，包括聊天历史和摘要</p>
                                <button id="backup-data-btn" class="btn btn-info">创建备份</button>
                            </div>
                        </div>

                        <div class="bulk-action-card">
                            <div class="action-icon">🔄</div>
                            <div class="action-content">
                                <h4>重建索引</h4>
                                <p>重新构建向量数据库索引，优化搜索性能</p>
                                <button id="rebuild-index-btn" class="btn btn-primary">重建索引</button>
                            </div>
                        </div>

                        <div class="bulk-action-card danger">
                            <div class="action-icon">⚠️</div>
                            <div class="action-content">
                                <h4>完全重置</h4>
                                <p>删除所有数据，恢复到初始状态</p>
                                <button id="full-reset-btn" class="btn btn-danger">完全重置</button>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- 状态消息 -->
                <div id="data-status" class="status-message" style="display: none;"></div>

                <!-- 操作确认对话框 -->
                <div id="confirmation-dialog" class="confirmation-dialog" style="display: none;">
                    <div class="dialog-content">
                        <h4 id="dialog-title">确认操作</h4>
                        <p id="dialog-message">您确定要执行此操作吗？</p>
                        <div class="dialog-actions">
                            <button id="dialog-confirm" class="btn btn-danger">确认</button>
                            <button id="dialog-cancel" class="btn btn-secondary">取消</button>
                        </div>
                    </div>
                    <div class="dialog-overlay"></div>
                </div>
            </div>
        </main>
    </div>

    <!-- JavaScript -->
    <script src="/static/js/data.js"></script>
</body>
</html>