<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>📚 章节管理 - LLMReader</title>

    <!-- CSS 样式 -->
    <link rel="stylesheet" href="/static/css/main.css">
    <link rel="stylesheet" href="/static/css/chapters.css">

    <!-- PDF.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
</head>
<body>
    <!-- 主容器 -->
    <div class="app-container chapters-app">
        <!-- 顶部导航栏 -->
        <header class="header">
            <div class="header-content">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <h1 class="header-title">📚 章节管理</h1>
                        <p class="header-subtitle">管理文档章节结构，预览PDF内容，重建向量数据库</p>
                    </div>
                    <div class="header-nav">
                        <a href="/" class="nav-link">🏠 首页</a>
                        <a href="/config" class="nav-link">⚙️ 配置管理</a>
                        <a href="/data" class="nav-link">📁 数据管理</a>
                        <a href="/chat" class="nav-link">💬 聊天模式</a>
                    </div>
                </div>
            </div>
        </header>

        <!-- 主内容区 -->
        <main class="chapters-main">
            <!-- 左侧：章节列表 -->
            <aside class="chapters-sidebar">
                <!-- 文档选择器 -->
                <div class="document-selector">
                    <label for="doc-select">📄 选择文档:</label>
                    <select id="doc-select" class="doc-select">
                        <option value="">-- 请选择文档 --</option>
                    </select>
                </div>

                <!-- 操作按钮 -->
                <div class="chapters-actions">
                    <button id="add-chapter-btn" class="btn btn-success" disabled>
                        ➕ 添加章节
                    </button>
                    <button id="rebuild-btn" class="btn btn-primary" disabled>
                        🔨 重建数据
                    </button>
                    <button id="refresh-btn" class="btn btn-secondary">
                        🔄 刷新
                    </button>
                </div>

                <!-- 章节统计 -->
                <div class="chapters-stats" id="chapters-stats" style="display: none;">
                    <span>📖 共 <strong id="chapter-count">0</strong> 个章节</span>
                    <span>📄 共 <strong id="page-count">0</strong> 页</span>
                </div>

                <!-- 章节列表容器 -->
                <div class="chapters-list-container" id="chapters-list-container">
                    <div class="empty-state">
                        <div class="empty-icon">📚</div>
                        <p>请选择一个文档查看章节</p>
                    </div>
                </div>
            </aside>

            <!-- 右侧：PDF预览 -->
            <section class="pdf-preview-section">
                <div class="pdf-preview-header">
                    <h3>📄 PDF 预览</h3>
                    <div class="pdf-controls">
                        <span class="page-info">共 <span id="total-pages">0</span> 页</span>
                        <span class="page-hint">（在PDF中可自由滚动浏览）</span>
                    </div>
                </div>
                <div class="pdf-canvas-container" id="pdf-canvas-container">
                    <div class="pdf-empty-state">
                        <div class="empty-icon">📄</div>
                        <p>选择文档后预览 PDF 内容</p>
                        <p class="hint">点击章节眼睛图标可跳转到对应页面</p>
                    </div>
                    <embed id="pdf-embed" class="pdf-embed-viewer" style="display: none;">
                </div>
            </section>
        </main>

        <!-- 状态消息 -->
        <div id="status-message" class="status-message" style="display: none;"></div>

        <!-- 编辑章节对话框 -->
        <div id="chapter-dialog" class="dialog-overlay" style="display: none;">
            <div class="dialog-content">
                <div class="dialog-header">
                    <h3 id="dialog-title">编辑章节</h3>
                    <button id="dialog-close" class="dialog-close">&times;</button>
                </div>
                <div class="dialog-body">
                    <div class="form-group">
                        <label for="chapter-title-input">章节标题:</label>
                        <input type="text" id="chapter-title-input" placeholder="请输入章节标题">
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="chapter-start-input">起始页码:</label>
                            <input type="number" id="chapter-start-input" min="1" value="1">
                        </div>
                        <div class="form-group">
                            <label for="chapter-end-input">结束页码:</label>
                            <input type="number" id="chapter-end-input" min="1" value="1">
                        </div>
                    </div>
                    <div class="page-preview">
                        <button id="preview-start-btn" class="btn btn-sm btn-info">👁️ 预览起始页</button>
                        <button id="preview-end-btn" class="btn btn-sm btn-info">👁️ 预览结束页</button>
                    </div>
                </div>
                <div class="dialog-footer">
                    <button id="dialog-cancel" class="btn btn-secondary">取消</button>
                    <button id="dialog-save" class="btn btn-primary">保存</button>
                </div>
            </div>
        </div>

        <!-- 确认对话框 -->
        <div id="confirm-dialog" class="dialog-overlay" style="display: none;">
            <div class="dialog-content dialog-small">
                <div class="dialog-header">
                    <h3 id="confirm-title">确认操作</h3>
                </div>
                <div class="dialog-body">
                    <p id="confirm-message"></p>
                </div>
                <div class="dialog-footer">
                    <button id="confirm-cancel" class="btn btn-secondary">取消</button>
                    <button id="confirm-ok" class="btn btn-danger">确认</button>
                </div>
            </div>
        </div>

        <!-- 进度覆盖层 -->
        <div id="progress-overlay" class="progress-overlay" style="display: none;">
            <div class="progress-content">
                <div class="spinner"></div>
                <h3 id="progress-title">处理中...</h3>
                <p id="progress-message">请稍候...</p>
                <div class="progress-hint">
                    <p>⏳ 处理过程可能需要 1-5 分钟</p>
                    <p>📊 正在处理章节内容和生成摘要</p>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="/static/js/chapters.js"></script>
</body>
</html>
